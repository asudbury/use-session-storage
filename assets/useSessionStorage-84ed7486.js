import{r as o}from"./index-8b3efc3f.js";const $={parse:JSON.parse,stringify:JSON.stringify},I=(e,r,i,s)=>{if(typeof window>"u")return r;try{const n=window.sessionStorage.getItem(e);if(n===null)return r;const a=i.parse(n);return typeof s=="function"?s(a):a}catch(n){return console.warn(`Error reading sessionStorage key "${e}":`,n),r}},x=(e,r,i)=>{if(!(typeof window>"u"))try{const s=i.stringify(r);window.sessionStorage.setItem(e,s),window.dispatchEvent(new CustomEvent("sessionStorageChange",{detail:{key:e,value:r}}))}catch(s){throw console.error(`Error setting sessionStorage key "${e}":`,s),s}},J=e=>{if(!(typeof window>"u"))try{window.sessionStorage.removeItem(e),window.dispatchEvent(new CustomEvent("sessionStorageChange",{detail:{key:e,value:null}}))}catch(r){throw console.error(`Error removing sessionStorage key "${e}":`,r),r}},M=(e,r)=>{const i=o.useRef(null);return o.useCallback((...s)=>{i.current!==null&&clearTimeout(i.current),i.current=setTimeout(()=>{e(...s)},r)},[e,r])};function O(e,r,i={}){const{serializer:s=$,validator:n,debounceMs:a=0,syncAcrossInstances:C=!0,onError:y}=i,[f,d]=o.useState(()=>I(e,r,s,n)),[R,g]=o.useState(!1),[z,h]=o.useState(null),b=o.useRef(!0),w=o.useRef(y);w.current=y;const c=o.useCallback(t=>{h(t),w.current!==null&&w.current!==void 0&&w.current(t)},[]),S=o.useCallback(t=>{try{g(!0),h(null),x(e,t,s),d(t)}catch(u){c(u)}finally{g(!1)}},[e,s,c]),m=M(S,a),E=o.useCallback(t=>{const u=typeof t=="function"?t(f):t;if(n!=null)try{const l=n(u);a>0?m(l):S(l)}catch(l){c(l)}else a>0?m(u):S(u)},[f,n,a,m,S,c]),L=o.useCallback(()=>{try{g(!0),h(null),J(e),d(r)}catch(t){c(t)}finally{g(!1)}},[e,r,c]),V=o.useCallback(()=>{E(r)},[E,r]);return o.useEffect(()=>{if(!C)return;const t=u=>{const{key:l,value:p}=u.detail;if(l===e)if(p===null)d(r);else try{const v=n!=null?n(p):p;d(v)}catch(v){c(v)}};return window.addEventListener("sessionStorageChange",t),()=>{window.removeEventListener("sessionStorageChange",t)}},[e,r,n,C,c]),o.useEffect(()=>{if(b.current){b.current=!1;return}const t=I(e,r,s,n);t!==f&&d(t)},[e,r,s,n,f]),[f,E,{loading:R,error:z,remove:L,reset:V}]}export{O as u};
